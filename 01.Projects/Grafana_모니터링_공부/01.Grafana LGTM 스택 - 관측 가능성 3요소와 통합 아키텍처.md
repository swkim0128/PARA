## 1. 메트릭(Metrics): 시스템의 건강 상태와 경향성 (Prometheus/Mimir)

소스에서 **메트릭**은 시스템의 동작과 성능을 수치로 정량화한 데이터로, CPU 사용량, 메모리 소비, 요청 수 등을 포함합니다.

• **Grafana 아키텍처 내 역할:** Grafana는 **Prometheus**나 **Mimir**와 같은 시계열 데이터베이스(TSDB)를 백엔드 데이터 소스로 연결하여 메트릭을 시각화합니다.

• **핵심 개념:**

◦ **집계(Aggregation):** 개별 이벤트보다는 시간 경과에 따른 추세(Trend)를 파악하는 데 중점을 둡니다. 예를 들어, **Micrometer**를 사용하여 Spring Boot 애플리케이션에서 수집된 데이터를 **Prometheus**가 스크랩하고, 이를 Grafana 대시보드에서 시각화하여 시스템의 전반적인 부하를 모니터링합니다.    ◦ **차원(Dimensionality):** 단순한 계층적 이름(Hierarchical naming) 대신 태그(Tags)나 레이블(Labels)을 사용하여 데이터를 다차원적으로 필터링하고 그룹화합니다.

## 2. 로그(Logs): 불변의 이벤트 기록과 문맥 (Loki)

**로그**는 시스템 내에서 발생한 이산적인 사건의 기록으로, 오류 발생 시점의 구체적인 상황이나 예외 메시지 등을 담고 있어 디버깅과 포렌식 분석의 핵심이 됩니다.

• **Grafana 아키텍처 내 역할:** **Grafana Loki**는 로그 집계를 담당하며, Prometheus와 유사한 라벨링 시스템을 사용하여 로그를 인덱싱합니다. 이를 통해 메트릭과 로그 간의 원활한 전환이 가능합니다.

• **핵심 개념:**

    ◦ **구조화된 로깅(Structured Logging):** 사람이 읽기 좋은 텍스트 로그에서 기계가 해석 가능한 JSON 형태(예: Elastic Common Schema)로 전환하여, Grafana에서 특정 필드(예: `user_id`, `trace_id`)를 기준으로 검색하고 분석할 수 있게 합니다.    ◦ **문맥 제공:** 메트릭이 "무엇"이 잘못되었는지를 알려준다면, 로그는 "왜" 잘못되었는지에 대한 상세한 문맥을 제공합니다.

## 3. 트레이스(Traces): 분산 시스템의 요청 흐름 (Tempo)

**트레이스**는 마이크로서비스 아키텍처와 같은 분산 시스템에서 요청이 여러 서비스를 거쳐 이동하는 경로를 추적하여, 각 단계의 지연 시간(Latency)과 병목 구간을 식별합니다.

• **Grafana 아키텍처 내 역할:** **Grafana Tempo**는 고도로 확장 가능한 분산 트레이싱 백엔드로, Jaeger나 Zipkin, OpenTelemetry 프로토콜과 호환됩니다.

• **핵심 개념:**

    ◦ **스팬(Span):** 트레이스는 여러 스팬으로 구성되며, 각 스팬은 특정 서비스 내에서의 작업을 나타냅니다.    ◦ **종속성 파악:** 서비스 간의 호출 관계를 시각화하여, 어떤 하위 서비스가 전체 응답 속도를 늦추고 있는지 파악합니다.

## 4. 통합 아키텍처: LGTM 스택과 상관관계(Correlation)

Grafana 아키텍처의 진정한 가치는 이 3요소를 개별적으로 보여주는 것이 아니라, \*\*상관관계(Correlation)\*\*를 통해 하나로 엮어내는 데 있습니다. 소스는 이를 **LGTM 스택** (Loki for Logs, Grafana for Visualization, Tempo for Traces, Mimir for Metrics)으로 설명합니다.

• **Trace ID를 통한 연결:** 이 모든 요소를 연결하는 핵심 키는 **Trace ID**입니다.

    ◦ **Metrics to Traces (Exemplars):** Prometheus 메트릭의 스파이크 지점(Exemplar)을 클릭하면, 해당 시점의 구체적인 Trace ID와 연결된 Tempo의 트레이스 뷰로 이동하여 문제의 트랜잭션을 즉시 확인할 수 있습니다.    ◦ **Traces to Logs:** 트레이스 스팬에서 \*\*파생 필드(Derived Fields)\*\*를 사용하여 해당 요청 처리 중에 생성된 로그(Loki)로 직접 이동할 수 있습니다.    ◦ **Logs to Traces:** 구조화된 로그 내에 포함된 `trace_id`를 통해 다시 트레이스 뷰로 이동하는 양방향 탐색이 가능합니다.

## 결론

Grafana의 맥락에서 **관측 가능성의 3요소**는 독립적인 데이터가 아닙니다. Grafana는 \*\*데이터 소스 추상화(Data Source Abstraction)\*\*와 \*\*상관관계 기능(Exemplars, Derived Fields)\*\*을 통해 메트릭(거시적 상태), 로그(세부 문맥), 트레이스(인과 관계)를 **하나의 통합된 분석 워크플로우**로 결합하는 아키텍처를 제공합니다. 이를 통해 사용자는 "무엇이 문제인가(Metrics)"에서 시작해 "어디서 발생했나(Traces)", "왜 발생했나(Logs)"로 이어지는 원활한 문제 해결 과정을 경험할 수 있습니다.
