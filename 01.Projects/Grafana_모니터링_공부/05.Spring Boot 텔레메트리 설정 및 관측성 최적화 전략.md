## Spring Boot 텔레메트리 설정 및 관측성 최적화 전략

제공된 소스들을 바탕으로 **Spring Boot 텔레메트리 설정(Telemetry Setup)**이라는 더 큰 맥락에서 **설정 관리(Configuration Management)**를 논의하면, 이는 단순한 애플리케이션 속성 정의를 넘어 **관측 가능성 파이프라인의 효율성, 성능, 그리고 운영 유연성을 결정짓는 핵심 엔지니어링 영역**으로 정의됩니다.

주요 논점은 다음과 같습니다.

### 1. 관측 가능성 진입점 제어: Actuator 설정

Spring Boot 텔레메트리의 시작은 **Spring Boot Actuator**의 설정입니다. 이는 애플리케이션의 내부 상태를 외부 모니터링 시스템(Prometheus 등)에 노출하는 게이트웨이 역할을 합니다.

• **엔드포인트 노출 관리:** 보안과 운영 필요성의 균형을 위해 `management.endpoints.web.exposure.include` 속성을 사용하여 필요한 엔드포인트(예: `health`, `metrics`, `prometheus`)만 선별적으로 노출해야 합니다.

• **Prometheus 통합:** `management.endpoint.prometheus.enabled=true` 및 `management.metrics.export.prometheus.enabled=true` 설정을 통해 애플리케이션 메트릭을 Prometheus가 스크랩할 수 있는 형식으로 변환하여 내보냅니다.

### 2. 메트릭 데이터의 질적 관리: Micrometer 설정

설정 관리는 수집되는 메트릭의 양과 질을 제어하여 모니터링 시스템의 과부하를 방지하고 데이터의 유용성을 높이는 데 필수적입니다.

• **카디널리티(Cardinality) 제어:** `MeterFilter`를 빈(Bean)으로 등록하여 불필요한 메트릭을 거부(`deny`)하거나, 과도한 태그를 제한(`maximumAllowableTags`)하는 설정이 중요합니다. 예를 들어, `MeterFilter.denyNameStartsWith("jvm")`으로 특정 그룹의 메트릭 수집을 차단하여 노이즈를 줄일 수 있습니다.

• **분포 통계 설정 (Histograms vs Summaries):** 분산 시스템 환경에서는 클라이언트 측 집계인 Summary 대신, 서버 측 집계가 가능한 Histogram을 사용해야 합니다. 이를 위해 `management.metrics.distribution.percentiles-histogram.http.server.requests=true` 설정을 활성화하여 백분위수(P99, P95) 계산을 위한 버킷 데이터를 생성해야 합니다.

• **공통 태그(Common Tags) 적용:** `MeterRegistryCustomizer`를 사용하여 `application` 이름이나 `region`과 같은 공통 태그를 모든 메트릭에 자동으로 주입함으로써, 멀티 인스턴스 환경에서 데이터를 쉽게 식별하고 필터링할 수 있도록 설정합니다.

### 3. 로깅 전략 및 성능 최적화 설정

로그 설정은 단순한 파일 기록을 넘어, 구조화된 데이터 생성과 애플리케이션 성능 보호를 위한 전략적 구성이 필요합니다.

• **구조화된 로깅(Structured Logging):** 사람이 읽기 쉬운 텍스트 대신 기계가 분석하기 쉬운 JSON 포맷(ECS, Logstash 등)으로 로그를 출력하도록 설정해야 합니다. Spring Boot 3.4 이상에서는 `logging.structured.format.console=ecs`와 같은 속성만으로 이를 쉽게 활성화할 수 있습니다.

• **동적 로그 레벨 변경:** 운영 중인 애플리케이션을 재시작하지 않고 특정 패키지의 로그 레벨을 변경하기 위해 Actuator의 `/loggers` 엔드포인트를 활용합니다. 이는 문제 해결 시 일시적으로 디버그 로그를 활성화하는 데 매우 유용합니다.

• **비동기 로깅(Async Logging):** 대규모 트래픽 환경에서는 I/O 블로킹을 방지하기 위해 Log4j 2의 비동기 로거(LMAX Disruptor 기반)를 사용하도록 설정합니다. 이는 시스템 속성을 통해 `-DLog4jContextSelector=...AsyncLoggerContextSelector`와 같이 설정하여 처리량을 비약적으로 높일 수 있습니다.

• **환경별 구성(Profile-specific):** `logback-spring.xml` 내에서 `<springProfile>` 태그를 사용하여 로컬 개발 환경과 프로덕션 환경의 로깅 설정을 분리하여 관리합니다.

### 4. 인프라로서의 대시보드 관리 (Provisioning)

Spring Boot 애플리케이션 외부의 시각화 도구(Grafana) 설정 또한 수동이 아닌 코드로 관리되어야 합니다.

• **프로비저닝(Provisioning):** Grafana의 데이터 소스와 대시보드를 UI에서 수동으로 설정하는 대신, YAML 구성 파일을 통해 선언적으로 정의합니다. 이는 재해 복구 시 신속한 복원을 가능하게 하고, 개발/운영 환경 간의 일관성을 보장합니다.

• **보안 설정:** 데이터 소스 연결 정보(비밀번호, API 키)는 `secureJsonData`를 통해 환경 변수나 보안 저장소에서 주입받도록 설정하여 보안성을 강화해야 합니다.

## 요약

Spring Boot 텔레메트리 맥락에서 **설정 관리**는 **1) Actuator를 통한 데이터 노출 범위 제어, 2) Micrometer 필터를 통한 메트릭 카디널리티 및 품질 관리, 3) 구조화 및 비동기 로깅을 통한 분석 효율성 및 성능 확보, 4) 프로비저닝을 통한 모니터링 인프라의 자동화**를 포괄하는 광범위한 전략입니다.